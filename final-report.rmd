---
title: 'Final Project: SARS-CoV-2 Dataset'
author: 'The Lads: Frankie Willard, Manny Mokel, Alex Katopodis, Parker Dingman'
subtitle: Due Friday, November 20, 11:59 PM
output:
  pdf_document: default
  html_document: default
---

``` {r setup, warning = F, message = F, echo = F}

knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(tidyverse)

covid <- read_csv("data/covid-data.csv")

```

### Introduction
Throughout the year 2020, the SARS-CoV-2 pandemic took the world by storm, deeply impacting every country on the planet, albeit with differing degrees of severity. As cases continued to rise, families suffered from the loss of family members, jobs, social interactions, disposable income, and more. 

This public health crisis became severe enough such that many countries took decisive action, shutting down their economies to prioritize the lives of citizens. Meanwhile, other countries were less strict in their policies, attempting to preserve their economy at the potential expense of their citizen’s lives. The difference in each country’s characteristics, demographics, public health capacities, and the strictness of SARS-CoV-2 policies led to vastly different effects of the pandemic on different countries. Given our personal connections to the effects of the pandemic through our lives, our friends, and our families, we wanted to determine what led to the pandemic affecting some places worse than others.  

We are interested in investigating how a country's demographics impact the domestic severity of SARS-CoV-2. More specifically, we would like to see which demographics lead to higher cases per capita and deaths per case. We are also interested in analyzing how effective lockdowns and SARS-CoV-2 related policies have been in mitigating the spread of the virus.   

We hypothesize that stringency-index, GDP per capita, population density, and human development index will have a strong impact on cases per capita. We also hypothesize that deaths per case will be largely determined by GDP per capita, the number of citizens aged 65+, hospital beds per thousand, and prevalence of pre-existing conditions (ex. diabetes prevalence, cardiovascular death rate, etc.). Finally, we expect that strict SARS-CoV-2 policy has effectively slowed the transmission of the virus. 

These hypotheses are based on prior experiences and research. There is evidence that a high stringency index, a composite score based on how strict a country's restrictions are, slows the spread of SARS-CoV-2 [9]. We also know that patients with pre-existing conditions face a higher SARS-CoV-2 mortality rate [10].  


### Data Description

We selected a data set from "Our World in Data." Each observation in the data set shows relevant SARS-CoV-2 data for a particular country on a given date. The SARS-CoV-2 data in the data set includes total deaths, total cases, new deaths, new cases, total cases per million, total deaths per million, total tests, new tests, total tests per thousand, positive rate, as well as telling country numbers such as stringency index (composite measure of government strictness policy) and hospital beds per thousand. Additionally, the data set includes country characteristics including population density, median age, GDP per capita, diabetes prevalence, life expectancy, and extreme poverty rate. While the previous variables are quantitative, the data set also includes categorical variables when it comes to geography such as the country and continent. 

“Our World In Data” uses data from the European Center for Disease Prevention and Control (ECDC), a world leader for SARS-CoV-2 data. The ECDC has a team of epidemiologists that works every day to screen up to 500 sources to get the latest figures. These sources include ministries of health (43%),  websites of public health institutes (9%),  websites of public health institutes (6%), World Health Organization (WHO) websites,  WHO situation reports (2%), and official dashboards and interactive maps from national and international institutions (10%). The EDEC also utilizes social media accounts maintained by national authorities, ministries of health, and official media outlets (30%). These social media sources are screened and validated by the other sources mentioned previously. The data is recorded daily, and we will be using the data set updated as of October 9, 2020 (10:30, London time).

We used latitude data from the website "Kaggle" to supplement the SARS-CoV-2 data set. This data was collected from a Google data set and was merged with the "Our World in Data" SARS-CoV-2 data set to create one larger data set.   

Here is a glimpse of our data set:

``` {r Glimpse}

glimpse(covid)

```


### Methodology
We will attempt to answer all of our research questions and hypotheses with similar approaches. We will create visualizations to graphically show any relationships we wish to analyze. We then plan to use linear models to analyze which variables in particular have relationships with total cases per capita and deaths per case.

Our graphs will consist of both line plots and world maps. The world maps will serve to show different variables with respect to geography. This will provide clear visualizations for us to identify countries and regions with high numbers of cases per capita and deaths per case. We can use maps comparatively with stringency index and cases per capita to see if median stringency index (chose median because resistant to outliers) and cases per capita are related, helping us analyze the effect of governmental policy on the transmission of SARS-CoV-2.

Our line plots will be used to visualize relationships between two variables. We like to visualize our response variable over time, looking at deaths per case as the pandemic progresses. We can visualize the change in deaths per case over time when color is based on a categorical variable, allowing us to see not only the relationship between the variable and the response (deaths per case), but also how the relationship changes over time.

Our regressions will be simple linear models with predictor variables that we hypothesized. We do not plan on including interaction variables in our models. We plan on adjusting our models to try and improve $R^2$ to a level we are satisfied with while also keeping them simple. This is due to the fact that simpler models are more interpretable, less overfit, and can reduce collinearity among the variables. This will help us model the relationship between various country characteristics including age, population-related statistics (density, total), pre-existing conditions (cardiovascular death rate, diabetes prevalence), and wealth/quality of public health system (GDP per capita, life expectancy, hospital beds per thousand, human development index), and see how these relate with total cases per capita and deaths per cases. 

In making our regression for deaths per cases, we choose to use deaths per cases using all deaths and cases accrued up until our cutoff date (October 5), as this provides a more stable variable to predict that represents a country's response overall. Deaths per cases were essentially 0 for many countries for so long due to a lack of cases (and lack of reporting for many countries), such that to model deaths per cases and determine relevant variables, we must model it later in the pandemic.

For our data analysis, we will look at stringency index, which is a composite variable based on nine other categories that determines how "strict" a country's SARS-CoV-2 prevention policies are, with 100 being the most strict and 0 meaning they have no SARS-CoV-2 related policies. These ordinal measurements of government responses include school closures, workplace closures, canceling of public events, restriction on gatherings, stay at home events, internal travel restrictions, international travel restrictions, and face covering policies [8]. Thus, it is able to provide us a comparative variable as to what the extent and severity a government's COVID response was. This will help us to analyze the relationship between country's government COVID response and the growth rate of SARS-CoV-2.

Additionally, we seek to find valuable predictors as to a country's total cases per capita and deaths per cases. Given the sheer number of variables, we can try hypothesis tests and bayesian paradigms on all of them, and thus we use a multiple linear regression to get an idea of the variables that have more statistically significant relationships with our response variable (deaths per case and cases per capita). 

We can then extract these variables, and then test to confirm a relationship between these variables and the response.

With deaths per cases, we categorize our significant variables into categories before visualizing them on an aforementioned line plot, to observe how the relationship with the response variable by analyzing the difference between the lines for each category. Additionally, in plotting against time, we can see how that relationship between predictors and response changes over time. 


Furthermore, we can test for a statistically significant relationship between a predictor and the response. This is done through a chi square test for independence, which determines if there is a statistically significant relationship or association between two categorical variables by calculating the distance between the observed response variable and expected response variable if the two variables are independent, and then squaring that difference (so its summation is positive regardless of if observed is greater than or less than expected), scaling it (based on expected value), and summing it for all observations. It is similar to a hypothesis test in that you see how likely our data (or more extreme) is likely to occur given that the null hypothesis (of independence) is true, providing us with a P-value to reject or fail to reject our null hypothesis. 

To do this, we categorize our predicted and response variables to meet the conditions for a chi square test for independence, creating bins that denote the extent of the magnitude of a country's predictor or respondent (cases per capita and deaths per case). In trying to make our statistical analyis unbiased, we try to make these choices through unarbitrary measures, such as seeing how the agencies or who report the statistics or other reputable sources generally categorize them. In performing a chi square test for independence, this will allow us to assess which variables are statistically significant with deaths per case and cases per capita, helping us answer our research question. 



```{r Mutate Variables and Join}

# Creating per capita metrics and categorizing HDI
covid <- covid %>%
  mutate(new_cases_per_cap = (new_cases/population),
         new_deaths_per_cap = (new_deaths/population),
         total_cases_per_cap = (total_cases/population),
         total_deaths_per_cap = (total_deaths/population)) %>%
  mutate(hdi_columns = case_when(
    human_development_index >= 0.8 ~ "Very High",
    human_development_index < 0.8 & human_development_index >= 0.7 ~ "High",
    human_development_index < 0.7 & human_development_index >= 0.55 ~ "Medium",
    human_development_index < 0.55 ~ "Low"
  )) %>% 
  mutate(deaths_per_case = total_deaths/total_cases)
  
# New data frame based on last available date when downloaded
covid_final_date <- covid %>% 
  mutate(stringency_index = if_else(is.na(stringency_index), 0, 
                                    stringency_index)) %>%
  group_by(location) %>%
  mutate(median_si = median(stringency_index),
         total_cases_per_cap = total_cases / population) %>%
  filter(date == "2020-10-05" & !is.na(continent)) %>% 
  mutate(final_deaths_per_case = total_deaths/total_cases)

```

### Results
### Hypothesis 1: Do Strict SARS-CoV-2 Related Policies Keep Total Cases per Capita Low?
Politicians worldwide are pushing for governments to enact strict policies to mitigate the spread of SARS-CoV-2. They argue that social distancing, stay-at-home orders, mask wearing, and business closures are all crucial to flatten the curve and keep Covid-related deaths low.

A Lancet study from early in the pandemic (using Wuhan as a case study) found that restrictions to social activities helps delay the epidemic peak, and that lifting governmental restrictions can bring about a second peak. Thus, stricter masking policies seemingly have merit in reducing viral transmission [3]. We are therefore interested in analyzing the relationship between stringency index and both total cases per capita and the growth rate of SARS-CoV-2 cases.

In order to visualize the relationship between a stringency index and the total cases per capita we created two world map plots. The first shows the median stringency index of a country during the entire pandemic while the second shows the total cases per capita on October 5th, 2020.

``` {r World Maps}

map_data <- covid_final_date %>%
  mutate(location = if_else(location == "United States", "USA", location)) %>%
  summarize(location, median_si, total_cases_per_cap,final_deaths_per_case)

map <- map_data("world")
covid_map <- left_join(map, map_data, by = c("region" = "location"))

ggplot(covid_map, mapping = aes(long, lat, group = group)) +
  coord_fixed(1.3) +
  geom_polygon(aes(fill = as.numeric(median_si)), color = "white") +
  scale_fill_gradient(low = "tomato", high = "seagreen1", 
                      name = "Median Stringency Index") +
  labs(title = "The median stringency index among all countries appears 
       to be approximately 60", 
       x = "Longitude", y = "Latitude")

ggplot(covid_map, mapping = aes(long, lat, group = group)) +
  coord_fixed(1.3) +
  geom_polygon(aes(fill = total_cases_per_cap), color = "white") +
  scale_fill_gradient(low = "seagreen1", high = "tomato", 
                      name = "Total Cases per Capita") +
  labs(title = "Total cases per capita by country suggesting that 
       total cases per capita varies largely by continent", 
       x = "Longitude", y = "Latitude")


```

From these world maps alone, it is difficult to determine if a high stringency index is associated with a low total cases per capita. There does not seem to be any pattern of high stringency index countries ending up with low total cases per capita. In fact, it appears from the visual alone that total cases per capita is mostly associated with continent. South America looks to have the highest stringency indices, but also the highest total cases per capita. From these two visualizations, it's hard to asses any relationship between stringency index and total cases per capita.

It also is useful to see how stringency index impacts the growth of cases over time. To visualize this, we will plot several countries that have both relatively high and low total cases per capita. The growth of cases will be represented by the factor for which the new cases changed from the previous day.

``` {r Modifying the Data for Individual Plotting}

covid_stringency <- covid %>%
  filter(!is.na(new_cases)) %>%
  filter(!is.na(stringency_index))

covid_stringency$growth_new_cases <- 0


for (i in 2:nrow(covid_stringency)) {
  temp <- covid_stringency$new_cases[i] / covid_stringency$new_cases[i - 1]
  covid_stringency$growth_new_cases[i] <- if_else(is.finite(temp), temp, NaN)
}


``` 

``` {r Plots of Individual Countries and their Stringency Indices / Case Growth Rate}
covid_stringency <- covid_stringency %>%
  select(location, date, new_cases, growth_new_cases, stringency_index)


plot_country <- function(x) {
  
  loc_data <- covid_stringency %>%
    filter(location == x)
  
  ggplot(data = loc_data, aes(x = date, y = stringency_index)) +
    geom_line() +
    labs(x = "Date",
       y = "Stringency Index",
       title = x) +
  ggplot(data = loc_data, aes(x = date, y = growth_new_cases)) +
    geom_line() +
    labs(x = "Date",
       y = "Daily Factor by Which New SARS-CoV-2 Cases Increased") +
    geom_hline(yintercept = 1, color = "red")

}

plot_country("United States")
plot_country("Russia")
plot_country("Saudi Arabia")
plot_country("Brazil")
plot_country("China")
plot_country("Germany")

```

From the graphs of individual countries, it appears that a high stringency index is associated with a lower volatility in the transmission rate of SARS-CoV-2. In the graphs of the US, Russia, and Saudi Arabia, this hold particularly true.  In the case of Brazil, China, and Germany, the graphs are a bit different. The transmission rates don't seem to flatten out nearly as much as they do in the US, Russia, and Saudi Arabia. There is still a good amount of volatility even after the mid-March spike.

For all countries there is a massive spike in cases during mid-March. This can be explained by the fact that cases were exploding during those few weeks globally. It was also around the same exact time that the World Health Organization declared SARS-CoV-2 a global pandemic because they were “deeply concerned by the alarming levels of spread and severity of the outbreak" and "the alarming levels of inaction” [4].

It should be noted that the red line on the "Rate of Spread of SARS-CoV-2" graphs represents a growth factor of 1, meaning that at this line cases per day was unchanged from one day to the next. Also most graphs contain large gaps in data pre mid-March. This is because data on new SARS-CoV-2 cases was not being consistently reported each day before then. Thus, there is no information to plot.

### Hypothesis 2: Which Demographics and Characteristics Impact Total Cases per Capita the Most?
To assess which factors had the largest impact on determining a countries total cases per capita, we will create a linear model to predict total cases per capita. This model will determine if certain variables are statistically significant in determining total cases per capita. 

We will use stringency index, GDP per capita, human development index, and population density as predictors since they were all in our hypothesis. In addition, we added continent as a predictor after observing its potential relevance in the world maps above. We will test our variables at the $\alpha = 0.05$ significance level.

Stringency Index:

$H_0$: There is no relationship between stringency index and total cases per capita. $\beta_{si}$ = 0

$H_1$: There is a relationship between stringency index and total cases per capita. $\beta_{si} \neq$ 0

GDP per Capita:

$H_0$: There is no relationship between GDP per Capita and total cases per capita. $\beta_{gdp}$ = 0

$H_1$: There is a relationship between GDP per Capita and total cases per capita. $\beta_{gdp} \neq$ 0

Human Development Index:

$H_0$: There is no relationship between Human Development Index and total cases per capita. $\beta_{hdi}$ = 0

$H_1$: There is a relationship between Human Development Index and total cases per capita. $\beta_{hdi} \neq$ 0

Population Density:

$H_0$: There is no relationship between Population Density and total cases per capita. $\beta_{pd}$ = 0

$H_1$: There is a relationship between Population Densityand total cases per capita. $\beta_{pd} \neq$ 0

``` {r Cases Per Capita Regression}

lm_cpc <- lm(total_cases_per_cap ~ median_si + gdp_per_capita + 
               population_density + human_development_index + continent, 
             data = covid_final_date)
lm_cpc %>%
 tidy() %>%
  arrange(p.value)

glance(lm_cpc) %>% 
  select(adj.r.squared, r.squared)

# Augmented Linear Model
m_aug <- augment(lm_cpc)

# Independence
ggplot(data = m_aug, 
       aes(x = 1:174, 
           y = .resid)) + 
  geom_point() + 
  labs(title = "Plot 1: Residuals in Order of the Dataset", 
       x = "Index", y = "Residual")

# Linearity and Equal Variance
ggplot(m_aug, mapping = aes(x = .fitted, y = .resid)) +
  geom_point() + 
  geom_hline(yintercept = 0, lwd = 2, col = "red", lty = 2) +
  labs(title = "Plot 2: PR Plot", x = "Predicted New Cases", y = "Residuals")

# Normality
ggplot(m_aug, mapping = aes(x= .resid)) +
  geom_histogram()

```

Total Cases Per Capita = -3.001862e-03 + 1.719410e-07 * (GDP per Capita) + 4.255473e-05	* (Median Stringency Index) + 1.503030e-07 * (Population Density) + 2.293517e-03 * (Human Development Index) - 4.502342e-03 * (Continent == Oceania) + 2.082339e-03 * (Continent == North America) + 1.298823e-05 * (Continent == Europe) + 7.959857e-03	* (Continent == South America) + 1.958916e-03 * (Continent == Asia)

After creating the linear model, we see that stringency index and GDP per capita have corresponding p values less than our significance level of 0.05. We reject the null hypotheses. There is sufficient evidence to suggest that there is a relationship between stringency index and total cases per capita as well as GDP per capita and total cases per capita.

As for the coefficients of population density and human development index, both have a p value greater than our significance level of 0.05. Therefore, we fail to reject the null hypothesis. There is not enough evidence to suggest that population density has any relationship to total cases per capita nor that human development index has any relationship to total cases per capita.

Our model also has an adjusted $R^2$ of 0.3088684. In the context of our research, this means that 30.9% of the variability in total cases per capita can be explained by the model which includes the stringency index, GDP per capita, population density, human development index, and continents.

Our model also shows that the continent of South America is statsitically significant in determining total cases per capita, also hinting at some association between continent and total cases per capita.

### Extra Analysis: Total Cases per Capita vs. Continent
Our visualizations and linear models suggest there might be some sort of relationship between total cases per capita and continent. In the visualization of total cases per capita on the world map, it appeared that continents seemed to have similar total cases per capita. In the linear model predicting total cases per capita, we observed that certain continent predictor weights were statistically significant. Thus, we will test for independence between total cases per capita and continent. We will do so using a chi-squared test at the $\alpha$ = 0.05 significance level.

$H_0$: There is independence between continent and total cases per capita.

$H_1$: There is NOT independence between continent and total cases per capita.

$\alpha = 0.05$

``` {r Chi-Squared Continent and CPC}

covid_tcpc <- covid %>%
  filter(!is.na(total_cases_per_cap) & !is.na(continent))

chisq.test(table(covid_tcpc$continent, covid_tcpc$total_cases_per_cap))

```

After running a $\chi^2$ test with a test statisitc of 227767 and 159400 degrees of freedom, we calculated a p value of 2.2e-16, which is less than our $\alpha$ = 0.05 significance level. Thus we reject the null hypothesis. There is sufficient evidence to suggest that continents are not independent from total cases per capita.

### Hypothesis 3: Which Demographics and Characteristics Impact Deaths per Case the Most?
```{r Deaths Per Case Map}

ggplot(covid_map, mapping = aes(long, lat, group = group)) +
  coord_fixed(1.3) +
  geom_polygon(aes(fill = final_deaths_per_case), color = "white") +
  scale_fill_gradient(low = "seagreen1", high = "tomato", 
                      name = "Total Deaths per Case") +
  labs(title = "Final Deaths Per Case per capita by country suggesting that
       deaths per case does not vary much by country except Yemen", 
       x = "Longitude", y = "Latitude")

```

In looking at this hypothesis, we first seek to explore the data. Thus, we created a line plot to visualize how the median deaths per case changes over time. We chose to visualize the median to prevent outlier countries from skewing the line in any direction. 

```{r Visualize Deaths Per Case}

covid_deaths_case <- covid %>%
  mutate(deaths_per_case = total_deaths/total_cases) %>%
  group_by(date) %>%
  filter(!is.na(deaths_per_case)) %>%
  mutate(avg_deaths_case = median(deaths_per_case),
         avg_total_case = mean(total_cases))

#Make title more informative
ggplot(data = covid_deaths_case, aes(x=date, y=avg_deaths_case)) +
  geom_line()+
  labs(x = "Date",
       y = "Deaths/Case",
       title = "Deaths Per Case Over Time")

```

In trying to determine what predictors have a relationship with deaths per case and what variables factor into a country's deaths per case, we decided to run a multiple linear regression including variables that encompass different country characteristics including age, pre-existing conditions (diabetes, smoking, cardiovascular death rate), as well as variables to predict how well a country's healthcare system may be including human development index, life expectancy, and GDP per capita (how much they may be able to spend on pandemic).


```{r Deaths Per Case Multiple Linear Regression, warning = FALSE, message = FALSE, echo = FALSE}

covid_deaths_reg <- covid %>%
  filter(date == "2020-10-05" & !is.na(continent)) %>%
  filter(!is.na(total_deaths) & !is.na(total_cases)) %>%
  mutate(final_deaths_per_case = total_deaths / total_cases) %>%
  select(final_deaths_per_case, 
         cardiovasc_death_rate,
         -contains("case") 
         & -contains("death") 
         & -contains("test")) %>%
  select(-iso_code, -continent, -location, -date, -positive_rate) %>%
  filter_all(all_vars(!is.na(.)))

m_main <- lm(final_deaths_per_case ~ diabetes_prevalence + aged_70_older + 
               female_smokers + human_development_index + gdp_per_capita + 
               life_expectancy + cardiovasc_death_rate + 
               handwashing_facilities + population_density, data = covid_deaths_reg)

m_main %>%
 tidy() %>% 
  arrange(desc(p.value))

glance(m_main) %>%
  select(r.squared, adj.r.squared)

```

In creating our regression, we found that the percentage of a country's population that is aged above 70, as well as human development index, to be the variables with the highest coefficients and most statistically significant P-values. Thus, we choose to explore them further in a line visualization, to see how they change over time. 

First we will look at human development index. We will visualize deaths per case over time as we did before, however, we will have different lines denoting different human development indexes. We have categorized them into bins of "Very high", "High", "Medium", "Low", and "Very Low", based on the various thresholds used by the UN [7]. 


```{r Visualize HDI vs Deaths/Case Over Time, warning = FALSE, message = FALSE, echo = FALSE}

#Could move this to exploratory data analysis

#Categories created based on 
# https://onlinelibrary.wiley.com/doi/full/10.1002/brb3.1755

  
covid_deaths_hdi <- covid %>%
  group_by(hdi_columns, date) %>%
  filter(!is.na(deaths_per_case) & !is.na(human_development_index)) %>%
  mutate(avg_deaths_case = median(deaths_per_case))


#Can Facet Wrap:   facet_wrap(hdi_columns~.)+

#Make title more informative
ggplot(data = covid_deaths_hdi, aes(x=date, y=avg_deaths_case, 
                                    color = hdi_columns)) +
  geom_line()+
  labs(x = "Date",
       y = "Deaths/Case",
       title = "Median Deaths Per Case Over Time",
       subtitle = "Color by Human Development Index Category",
       color = "HDI Category")


```

In visualizing the line plot of deaths per case over time colored by human development categories, there are clear distinctions between the different categories, especially around May and June. Thus, we will test for independence between human development index category and deaths per case. We will do so using a chi-squared test at the $\alpha$ = 0.05 significance level.

$H_0$: Human development index category and deaths per case are independent.

$H_0$: Human development index category and deaths per case are NOT independent.


```{r Chi Square Test HDI Columns}

covid_hdic <- covid %>%
  filter(!is.na(hdi_columns) & !is.na(deaths_per_case))

chisq.test(table(covid_hdic$hdi_columns, covid_hdic$deaths_per_case))$p.value

```

Our test statistic was 83240, which has a chi-square distribution with 73212 degree of freedom under $H_0$. This correlates with a P-value approximately equal to 2.487605e-139 which is less than $\alpha$ = 0.05, such that we reject the null hypothesis. There is sufficient evidence to suggest that human development index category and deaths per case are not independent.



```{r Aged Visualization}

covid <- covid %>% 
  mutate(aged_columns = case_when(
    aged_70_older >= 16 ~ "Very High",
    aged_70_older < 16 & aged_70_older >= 12 ~ "High",
    aged_70_older < 12 & aged_70_older >= 8 ~ "Medium",
    aged_70_older < 8 & aged_70_older >= 4 ~ "Low",
    aged_70_older < 4 & aged_70_older >= 0 ~ "Very Low"
  ))

covid_deaths_age <- covid %>%
  group_by(aged_columns, date) %>%
  filter(!is.na(deaths_per_case) & !is.na(aged_70_older)) %>%
  mutate(avg_deaths_case = median(deaths_per_case))


#Can Facet Wrap:   facet_wrap(hdi_columns~.)+

#Make title more informative
ggplot(data = covid_deaths_age, aes(x=date, y=avg_deaths_case, 
                                    color = aged_columns)) +
  geom_line()+
  labs(x = "Date",
       y = "Deaths/Case",
       title = "Median Deaths Per Case Over Time",
       subtitle = "Color by Aged 70+ Category",
       color = "Aged Category")

```

In visualizing the line plot of deaths per case over time colored by categories denoting the percentage of the country's population that is aged 70 or older, there are stark contrasts in the line throughout the entire duration of the pandemic, with higher percentages of populations aged 70 or older having higher median deaths per case. Thus, to test for statistical significance, we will perform a test for independence between aged category and deaths per case. We will do so using a chi-squared test at the $\alpha$ = 0.05 significance level.

$H_0$: Human development index and deaths per case are independent.

$H_0$: Human development index and deaths per case are NOT independent.


```{r Chi Square Test Aged Columns}

covid_aged <- covid %>%
  filter(!is.na(aged_columns) & !is.na(deaths_per_case))

chisq.test(table(covid_aged$aged_columns, covid_aged$deaths_per_case))$p.value

```

Our test statistic was 126458, which has a chi-square distribution with 99284 degrees of freedom under $H_0$. This correlates with a P-value approximately equal to 0, which is less than $\alpha$ = 0.05, such that we reject the null hypothesis. There is sufficient evidence to suggest that aged category and deaths per case are not independent.




### Discussion

### Hypothesis 1


### Hypothesis 2

### Hypothesis 3
 
Map:

Figure 1: 

Figure 2 (HDI):

Chi-Square Test (HDI): 
 

Figure 3 (Aged):

Chi-Square Test (Aged): 



### Limitations

When it comes to our dataset and statistical analysis, there are many limitations to consider. In the dataset, there was missingness in the data, as many countries did not report testing, cases, positive rate, or deaths at different points especially early on, as well as data on country data  such as percentage of male smokers and female smokers, cardiovascular death rate, extreme poverty rate, handwashing facilities, hospital beds per thousand, and human development index. This led to countries potentially being under or over-represented in the data based on whether or not their data was public and added to this dataset. These are key factors in the governmental policy, viral transmission, and death rate of countries that we seek to explore, such that this missingness reduces the reliability of our statistical analysis. 

Additionally, SARS-CoV-2 data reporting and testing varies significantly by country, such that countries that lack comprehensive testing programs skew our anlaysis by reporting less cases than there are. Given that we are seeking to determine factors that affect cases per capita and deaths per case, knowledge of the true cases within each country is crucial to coming to this understanding. The disparity in the level of testing as well as reporting for cases and deaths among different countries adds bias to the model that we can not truly pinpoint and address without knowing the true numbers for these countries.

Given that the project started in October, our dataset only includes data up to October 5th. Over one month has passed since then, and we have seen a dramatic uptick in the new cases and total cases around the world, with the daily new cases increasing from ~270,000 when we downloaded the dataset to over 500,000 daily new cases globally now [5]. Many countries have experienced rapid growth/new spikes in cases and deaths, providing new and helpful information about the dissemination and deaths of the SARS-CoV-2. In not having this new data in our dataset, our statistical analysis will fail to interpret this new and potentially vital or enlightening information that could shed more light on the effect of different variables over time. 

The previous limitation is ultimately rooted in the fact that  SARS-CoV-2 is dynamic and novel, meaning that we are still learning about the virus and it is hard to know what variables have the most impact on spread and death rate. For example,experimentation on the virus publishd in the Journal of Translational Medicine found evidence for different geographical strains of SARS-CoV-2, as the virus is evolving and mutating. This is an important variable that is not in our dataset, but could be a confounding variable if a strain is more infectious or more fatal, as we seek to determine what affects  deaths per case and total cases per capita being.
Our dataset likely does not include all relevant variables, which can be seen in our regressions as we are only able to account for 49% of the variance explained in deaths per case and 30.9% of the variance explained in total cases per capita. With so many variables changing over time and many relevant variables likely not in the dataset, it is difficult to determine the greatest factors in the spread and fatality rate of SARS-CoV-2.

Finally, our data is of a time series format, which we have less statistical experience dealing with. Time series data requires a different style of analysis as each observation is not independent of each other (e.g. cases yesterday is not independent of cases today). This was yet another problem in our linear regression model. Our linear regression model did not pass all of the diagnostic plots and thus must be interpreted as biased and virtually unusable. Our linear regression model is also limited in that it assumes a linear relationship between the variables, when in fact there may not be. For example, there could be a polynomial relationship between a variable and the response, the larger it gets, the more it affects the response variable. 
Additionally, the regression model can not attribute causality, but only an association. While a predictor and response variable may share a linear relationship, this could potentially be due to a confounding variable, such that the predictor does not actually cause the response. For example, people being aged 70 or older having a higher negative coefficient and negative relationship with deaths per case in the regression could be because of another variable. More people being aged 70 could lead to more retired people and less people in the workforce and medical system, causing deaths per case to be higher. This is thus a limit of using a linear regression. 

With our current regression, another limitation is variables can be collinear, leading to coefficients that do not accurately reflect the relationship between the variable and a model. When running a linear regression, two multicollinear variables may have correlation coefficients that differ but rather additively have their true effect, as linear regressions struggle to differentiate the effects of two multicollinear variables. This is why machine learning specialists often perform feature selection (via ridge and lasso regression) and principal components analysis, to remove predictors and a model with more consistency in its correlation coefficients.


Talk more about diagnostic plots:
* Heteroscedastic?
* Normality

Notes
* Analyze maps

### References

[1] https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7418951/#:~:text=Our%20model%20implies%20that%20social,at%2021%20days%20after%20implementation.
[2] https://www.cdc.gov/coronavirus/2019-ncov/need-extra-precautions/people-with-medical-conditions.html#:~:text=Adults%20of%20any%20age%20with%20the%20following%20conditions%20are%20at,COPD%20(chronic%20obstructive%20pulmonary%20disease)
[3] https://www.thelancet.com/journals/lanpub/article/PIIS2468-2667(20)30073-6/fulltext
[4] https://www.ajmc.com/view/a-timeline-of-covid19-developments-in-2020
[5] https://www.worldometers.info/coronavirus/
[6] https://pubmed.ncbi.nlm.nih.gov/32321524/
[7] https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7507379/
[8] https://ourworldindata.org/grapher/covid-stringency-index
[9] https://ourworldindata.org/coronavirus-source-data
[10] https://www.ecdc.europa.eu/en/covid-19/data-collection
